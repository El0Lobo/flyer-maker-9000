<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flyer Maker</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Roboto:wght@400;700&display=swap&family=Lobster:wght@400;700&family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <header>
    <h1>Flyertron 9000</h1>
  </header>

  <main>
    <!-- Tools Section -->
    <section class="section text-tools">
      <h2>Event & Text Tools</h2>
      <button id="open-modal" class="btn btn-primary">Add a Event</button>
      <div id="event-modal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <div class="event">
            <h2>Event Details</h2>
            <div class="colors d-flex align-items-center mb-2">
              <label for="text-color-picker" style="width: 100px;">Color?:</label>
              <input type="checkbox" id="apply-color" checked style="height: min-content;">
              <input type="color" id="text-color-picker" value="#ffffff">
              <label for="text-outline-picker" class="ml-2">Outline?:</label>
              <input type="checkbox" id="apply-outline" style="height: min-content;">
              <input type="color" id="text-outline-picker" value="none">
              <label for="text-glow-picker" class="ml-2">Glow?:</label>
              <input type="checkbox" id="apply-glow" style="height: min-content;">
              <input type="color" id="text-glow-picker" value="none">
            </div>
            <div class="font-selection d-flex align-items-center mb-2" style="gap:10px;">
              <label for="font-picker">Font:</label>
              <select id="font-picker" style="width:150px;"></select>
            </div>
            <label for="text-selector">Select Mode:</label>
            <select id="text-selector" class="mb-2">
              <option value="Demo">Demo</option>
            </select>
            <!-- Demo Form -->
            <div class="form-section Demo">
              <div class="form-group">
                <label for="demo-title">Title:</label>
                <input type="text" id="demo-title" class="form-control">
              </div>
              <div class="form-group">
                <label for="demo-description">Description:</label>
                <textarea id="demo-description" class="form-control"></textarea>
              </div>
              <div class="form-group">
                <label for="demo-date">Date:</label>
                <input type="date" id="demo-date" class="form-control">
              </div>
              <div class="form-group">
                <label for="demo-time">When:</label>
                <input type="time" id="demo-time" class="form-control">
              </div>
              <div class="form-group">
                <label for="demo-start">Start:</label>
                <input type="time" id="demo-start" class="form-control">
              </div>
              <div class="form-group">
                <label for="demo-place">Where:</label>
                <input type="text" id="demo-place" class="form-control">
              </div>
              <div class="form-group">
                <label for="event-place">Street:</label>
                <input type="text" id="event-place" placeholder="Enter a location" class="form-control">
                <ul id="address-suggestions"></ul>
              </div>
              <div class="form-group">
                <label for="demo-image-upload">Image:</label>
                <input type="file" id="demo-image-upload" accept="image/*" class="form-control">
              </div>
            </div>
            <!-- Additional form sections (Event, Menu) can be added similarly -->
            <button id="add-event-details" class="btn btn-success">Add Event Details</button>
          </div>
        </div>
      </div>

      <hr>
      <h2>Add Text</h2>
      <div id="additional-text">
        <textarea id="text-input" class="form-control mb-2" placeholder="Enter your text"></textarea>
        <div class="font-selection d-flex align-items-center mb-2" style="gap:10px;">
          <label for="additional-text-font">Font:</label>
          <select id="additional-text-font" style="width:150px;" class="form-control"></select>
        </div>
        <div class="colors d-flex align-items-center mb-2">
          <label for="text-color-picker2">Color:</label>
          <input type="checkbox" id="apply-color2" checked style="height: min-content;">
          <input type="color" id="text-color-picker2" value="#000000">
          <label for="text-outline-picker2" class="ml-2">Outline:</label>
          <input type="checkbox" id="apply-outline2" checked style="height: min-content;">
          <input type="color" id="text-outline-picker2" value="none">
          <label for="text-glow-picker2" class="ml-2">Glow:</label>
          <input type="checkbox" id="apply-glow2" checked style="height: min-content;">
          <input type="color" id="text-glow-picker2" value="none">
        </div>
        <div class="sliders d-flex align-items-center mb-2" style="gap:10px;">
          <label for="outline-size-slider">Outline Size:</label>
          <input type="range" id="outline-size-slider" min="0" max="3" value="0.5" step="0.01">
          <label for="glow-size-slider">Glow Size:</label>
          <input type="range" id="glow-size-slider" min="0" max="350" value="10">
        </div>
        <div class="text-style-options d-flex align-items-center mb-2">
          <label><input type="checkbox" id="text-bold"> Bold</label>
          <label class="ml-2"><input type="checkbox" id="text-italic"> Italic</label>
          <label class="ml-2"><input type="checkbox" id="text-underline"> Underline</label>
          <label class="ml-2"><input type="checkbox" id="text-strikethrough"> Strikethrough</label>
        </div>
        <div class="text-style-options d-flex align-items-center mb-2">
          <label for="text-align">Align:</label>
          <select id="text-align" class="form-control" style="width:150px;">
            <option value="left" selected>Left</option>
            <option value="center">Center</option>
            <option value="right">Right</option>
            <option value="justify">Justify</option>
          </select>
        </div>
        <button id="add-text-btn" class="btn btn-info">Add Text</button>
      </div>
      <hr>
      <button id="save-placements" class="btn btn-secondary">Save Placements</button>
      <input type="file" id="import-placements" accept="application/json">
    </section>

    <!-- Canvas Section -->
    <section class="section canvas-section">
      <h2>Canvas</h2>
      <div class="canvas-symbols mb-2">
        <img src="material/square.png" class="canvas-symbol canvas-symbol-active" data-id="Instapost" style="width: 50px; height: 50px;">
        <img src="material/portrait.png" class="canvas-symbol" data-id="portrait" style="width: 50px; height: 70px; position: relative; top: -18px;">
        <img src="material/landscape.png" class="canvas-symbol" data-id="landscape" style="width: 70px; height: 50px;">
      </div>
      <div class="canvas-container">
        <canvas class="image-editor" id="wa-image-editor-canvas"></canvas>
      </div>
    </section>

    <!-- Assets Section -->
    <section class="section assets-section">
      <h2>Assets & Drawing Tools</h2>
      <div class="drawing-controls mb-2">
        <h3>Draw Controls</h3>
        <div class="form-group">
          <label for="color-picker">Color:</label>
          <input type="color" id="color-picker" value="#ffffff">
        </div>
        <div class="form-group">
          <label for="size-slider">Size:</label>
          <input type="range" id="size-slider" min="1" max="120" value="5" style="max-width:150px;">
        </div>
        <button id="toggle-drawing" class="btn btn-warning">Start Drawing</button>
      </div>
      <div class="picture-settings mb-2">
        <h3>Picture Settings</h3>
        <div class="form-group">
          <label for="svg-color-picker">Color:</label>
          <input type="color" id="svg-color-picker" value="#000000">
        </div>
        <div class="form-group">
          <label for="opacity-slider">Opacity:</label>
          <input type="range" id="opacity-slider" min="0" max="1" value="1" step="0.01" style="max-width:150px;">
        </div>
        <input type="file" id="background-upload" accept="image/*" style="display:none;">
        <button id="upload-bg-btn" class="btn btn-outline-primary">Upload Background</button>
        <input type="file" id="asset-upload" accept="image/*" style="display:none;">
        <button id="upload-asset-btn" class="btn btn-outline-secondary">Upload Asset</button>
      </div>
      <div id="assets-container"></div>
      <div class="user-uploads">
        <h3>User Uploads</h3>
        <ul class="content"></ul>
      </div>
    </section>

    <!-- Top Bar Section -->
    <section class="section top-bar-section">
      <div class="top-bar d-flex flex-wrap justify-content-between align-items-center">
        <button id="export-png" class="btn btn-success">Export to PNG</button>
        <div class="zoom-controls d-flex align-items-center">
          <label for="zoom-range" class="mr-2">Zoom:</label>
          <input type="range" id="zoom-range" min="0.1" max="1" step="0.01" value="0.5">
        </div>
        <div class="panning-controls d-flex align-items-center">
          <label for="pan-x" class="mr-2">Pan X:</label>
          <input type="number" id="pan-x" value="0" step="10">
          <label for="pan-y" class="ml-2 mr-2">Pan Y:</label>
          <input type="number" id="pan-y" value="0" step="10">
        </div>
        <div class="acme d-flex align-items-center">
          <span class="footer-text mr-2">Developed by</span>
          <a href="https://acme-prototypes.com/" class="footer-link">
            <img src="material/ACME (Small).png" class="footer-symbol" alt="ACME Logo">
          </a>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Flyertron 9000</p>
  </footer>

  <!-- Help Overlay -->
  <div id="help-overlay" class="help-overlay">
    <div id="help-modal" class="help-modal">
      <span class="close-modal" id="close-help">&times;</span>
      <h2>Features & Controls</h2>
      <!-- Help modal content -->
      <h3>Canvas Controls</h3>
      <h4>Zoom & Pan</h4>
      <ul>
        <li>Use the zoom slider to adjust zoom levels.</li>
        <li>Scroll wheel can be used to zoom in and out.</li>
        <li>Use the arrow keys to pan across the canvas.</li>
        <li>Middle mouse button drag allows panning.</li>
      </ul>
      <h4>Modes</h4>
      <p>Click the 'Square', 'Portrait', or 'Landscape' buttons to set the appropriate canvas size and background.</p>
      <h3>Adding and Editing Text</h3>
      <ul>
        <li>Select a text type from the dropdown menu (Info, Concert, Demo, Event).</li>
        <li>Enter the text details (title, description, date, etc.).</li>
        <li>Click 'Add Event Details' to place text on the canvas.</li>
        <li>Click the edit icon near a selected text element to modify text.</li>
        <li>Customize text properties (color, outline, glow, font, alignment).</li>
      </ul>
      <h3>Layers & Object Manipulation</h3>
      <ul>
        <li>Delete: Removes the selected object.</li>
        <li>Move Up: Brings the selected object one layer forward.</li>
        <li>Move Down: Sends the selected object one layer backward.</li>
      </ul>
      <h3>Adding Images</h3>
      <ul>
        <li>Click 'Upload Background' to set a custom background.</li>
        <li>Click 'Upload Asset' to add custom images.</li>
        <li>Click on image assets in the sidebar to place them on the canvas.</li>
      </ul>
      <h3>Drawing Tools</h3>
      <ul>
        <li>Click 'Start Drawing' to enable freehand drawing.</li>
        <li>Adjust color and brush size using the sliders.</li>
        <li>Click 'Stop Drawing' to return to normal mode.</li>
      </ul>
      <h3>Exporting Your Flyer</h3>
      <ul>
        <li>Click 'Export to PNG' to download the flyer.</li>
        <li>Ensure all final adjustments are made before exporting.</li>
      </ul>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Help Overlay Logic
      const openHelp = document.getElementById("open-help");
      const helpOverlay = document.getElementById("help-overlay");
      const closeHelp = document.getElementById("close-help");

      if(openHelp) {
        openHelp.addEventListener("click", function() {
          helpOverlay.style.display = "flex";
        });
      }

      if(closeHelp) {
        closeHelp.addEventListener("click", function() {
          helpOverlay.style.display = "none";
        });
      }

      helpOverlay.addEventListener("click", function(event) {
        if (event.target === helpOverlay) {
          helpOverlay.style.display = "none";
        }
      });

      // Event Modal Logic
      const modal = document.getElementById("event-modal");
      const openModal = document.getElementById("open-modal");
      const closeModal = document.querySelector(".close");
      openModal.addEventListener("click", () => {
        modal.style.display = "flex";
      });
      closeModal.addEventListener("click", () => {
        modal.style.display = "none";
      });
      window.addEventListener("click", (e) => {
        if (e.target === modal) {
          modal.style.display = "none";
        }
      });

      // Address Suggestions
      const input = document.getElementById("event-place");
      const suggestionBox = document.getElementById("address-suggestions");

      input.addEventListener("input", function () {
        let query = input.value.trim();
        if (query.length < 3) {
          suggestionBox.innerHTML = "";
          return;
        }
        fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&addressdetails=1&limit=5`)
          .then(response => response.json())
          .then(data => {
            suggestionBox.innerHTML = "";
            data.forEach(place => {
              let li = document.createElement("li");
              const address = place.address;
              const formattedAddress = [
                address.road || "",
                address.house_number || "",
                address.suburb || address.district || "",
                address.city || address.town || address.village || "",
                address.postcode || ""
              ].filter(Boolean).join(", ");
              li.textContent = `Address: ${formattedAddress}`;
              li.style.padding = "5px";
              li.style.cursor = "pointer";
              li.addEventListener("click", function () {
                input.value = formattedAddress;
                input.dataset.selectedAddress = formattedAddress;
                suggestionBox.innerHTML = "";
              });
              suggestionBox.appendChild(li);
            });
          })
          .catch(error => console.error("Error fetching location data:", error));
      });

      document.addEventListener("click", function (e) {
        if (!input.contains(e.target) && !suggestionBox.contains(e.target)) {
          suggestionBox.innerHTML = "";
        }
      });

      // Mode Change Logic (using jQuery)
      $(document).ready(function () {
        $('#text-selector').on('change', function () {
          const selectedMode = $(this).val();
          $('.form-section').hide();
          $(`.form-section.${selectedMode}`).show();
          if (selectedMode === 'Menu') {
            $('.canvas-symbol[data-id="landscape"]').trigger('click');
          }
        });
        $('#text-selector').trigger('change');
      });
    });
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.7.8/fabric.min.js"></script>
  <script src="./script.js"></script>
</body>
</html>
